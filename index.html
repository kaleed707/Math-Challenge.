<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ø¯ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --success: #4cc9f0;
            --dark: #2b2d42;
            --light: #f8f9fa;
            --correct: #4ade80;
            --wrong: #f87171;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
        }
        
        .game-container {
            background-color: white;
            border-radius: 20px;
            box-shadow: var(--shadow);
            width: 95%;
            max-width: 1000px;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .game-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--success), var(--primary));
        }
        
        h1 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 2.8rem;
            position: relative;
            display: inline-block;
        }
        
        h1::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 25%;
            width: 50%;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
        }
        
        h2 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        p {
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 10px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: var(--transition);
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn:disabled:hover::before {
            left: -100%;
        }
        
        /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-screen {
            text-align: center;
            padding: 20px;
        }
        
        .avatar-selection {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: var(--transition);
            border: 3px solid transparent;
        }
        
        .avatar:hover {
            transform: scale(1.1);
        }
        
        .avatar.selected {
            border-color: var(--primary);
            background: var(--light);
        }
        
        .form-group {
            margin: 20px 0;
            text-align: right;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--dark);
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        .welcome-screen {
            text-align: center;
            padding: 20px;
        }
        
        .character {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            background: linear-gradient(135deg, var(--success), var(--primary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: white;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            animation: bounce 2s infinite alternate;
        }
        
        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-15px); }
        }
        
        .game-modes {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 30px 0;
            gap: 20px;
        }
        
        .mode-card {
            background-color: var(--light);
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px 15px;
            width: 170px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .mode-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .mode-card:hover {
            background-color: #e9ecef;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .mode-card.selected {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: var(--primary);
        }
        
        .mode-card.selected i {
            color: white;
        }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .game-screen {
            text-align: center;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--light);
            border-radius: 15px;
        }
        
        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .stats {
            display: flex;
            gap: 20px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--dark);
        }
        
        .question-box {
            background-color: var(--light);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .question {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--dark);
            text-align: right;
        }
        
        .expression {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--primary);
            margin: 15px 0;
            direction: ltr;
            text-align: center;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .option {
            background-color: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.3rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .option:hover {
            background-color: #f1f2f6;
            transform: scale(1.05);
        }
        
        .option.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .option.correct {
            background-color: var(--correct);
            color: white;
            border-color: var(--correct);
            animation: pulse 0.5s;
        }
        
        .option.wrong {
            background-color: var(--wrong);
            color: white;
            border-color: var(--wrong);
            animation: shake 0.5s;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .feedback {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 15px 0;
            min-height: 40px;
        }
        
        .correct-feedback {
            color: var(--correct);
        }
        
        .wrong-feedback {
            color: var(--wrong);
        }
        
        .timer-container {
            margin: 20px 0;
        }
        
        .timer-bar {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .timer {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent));
            width: 100%;
            transition: width 1s linear;
        }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
        .results-screen {
            text-align: center;
            padding: 20px;
        }
        
        .trophy {
            font-size: 5rem;
            color: gold;
            margin: 20px 0;
            animation: spin 2s;
        }
        
        @keyframes spin {
            0% { transform: rotate(0) scale(0.5); opacity: 0; }
            100% { transform: rotate(360deg) scale(1); opacity: 1; }
        }
        
        .score-display {
            font-size: 4rem;
            font-weight: bold;
            color: var(--primary);
            margin: 20px 0;
        }
        
        .result-message {
            font-size: 1.8rem;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--light);
            display: inline-block;
        }
        
        .result-details {
            margin: 20px 0;
            text-align: right;
            background-color: var(--light);
            padding: 20px;
            border-radius: 15px;
        }
        
        .result-details p {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        
        .achievements {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .achievement {
            background-color: var(--light);
            padding: 15px;
            border-radius: 10px;
            min-width: 120px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .achievement i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-screen {
            text-align: center;
            padding: 20px;
        }
        
        .leaderboard {
            margin: 20px 0;
            background-color: var(--light);
            border-radius: 15px;
            padding: 20px;
            text-align: right;
        }
        
        .leaderboard table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .leaderboard th, .leaderboard td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .leaderboard th {
            background-color: var(--primary);
            color: white;
        }
        
        .leaderboard tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .leaderboard tr:hover {
            background-color: #e9ecef;
        }
        
        .rank-1 {
            background-color: gold !important;
            font-weight: bold;
        }
        
        .rank-2 {
            background-color: silver !important;
        }
        
        .rank-3 {
            background-color: #cd7f32 !important;
        }
        
        .student-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background-color: var(--light);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        /* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ */
        .project-info {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed #ddd;
            text-align: center;
            color: #7f8c8d;
        }
        
        .project-info h3 {
            margin-bottom: 15px;
            color: var(--dark);
        }
        
        .student-info, .teacher-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .info-card {
            background-color: var(--light);
            padding: 15px;
            border-radius: 10px;
            min-width: 200px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙØ­Ø§Øª */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .active {
            display: block;
        }
        
        /* Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ Ù„Ù„Ù‡ÙˆØ§ØªÙ */
        @media (max-width: 768px) {
            .game-container {
                width: 95%;
                padding: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .mode-card {
                width: 140px;
                padding: 20px 10px;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .expression {
                font-size: 1.8rem;
            }
            
            .student-info, .teacher-info {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .game-header {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: var(--accent);
            opacity: 0;
            z-index: 1000;
        }
        
        .floating-math {
            position: fixed;
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.3);
            z-index: -1;
            animation: float 15s infinite linear;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <!-- ØªØ£Ø«ÙŠØ±Ø§Øª Ø±ÙŠØ§Ø¶ÙŠØ© Ø¹Ø§Ø¦Ù…Ø© -->
    <div id="floating-math"></div>
    
    <div class="game-container">
        <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div id="login-screen" class="screen active">
            <div class="login-screen">
                <h1><i class="fas fa-user-graduate"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</h1>
                <p>Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</p>
                
                <div class="form-group">
                    <label for="student-name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
                    <input type="text" id="student-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
                </div>
                
                <div class="form-group">
                    <label for="student-class">Ø§Ù„ØµÙ</label>
                    <input type="text" id="student-class" value="Ø£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ" readonly>
                </div>
                
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± ØµÙˆØ±ØªÙƒ Ø§Ù„Ø±Ù…Ø²ÙŠØ©</label>
                    <div class="avatar-selection">
                        <div class="avatar" data-avatar="1">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="avatar" data-avatar="2">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="avatar" data-avatar="3">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <div class="avatar" data-avatar="4">
                            <i class="fas fa-user-ninja"></i>
                        </div>
                    </div>
                </div>
                
                <button id="login-btn" class="btn">
                    <i class="fas fa-sign-in-alt"></i> Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ
                </button>
                
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
                <div class="project-info">
                    <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h3>
                    <div class="student-info">
                        <div class="info-card">
                            <i class="fas fa-user-graduate"></i>
                            <h4>Ø§Ù„Ø·Ø§Ù„Ø¨</h4>
                            <p>Ø¨Ø§Ø³Ù„ Ø®Ø§Ù„Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ù„Ù…Ø±ÙŠØ´Ø¯</p>
                        </div>
                    </div>
                    <div class="teacher-info">
                        <div class="info-card">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <h4>Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</h4>
                            <p>Ù…Ø­Ù…Ø¯ Ø­Ø§Ù…Ø¯</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
        <div id="welcome-screen" class="screen">
            <div class="welcome-screen">
                <h1><i class="fas fa-gamepad"></i> ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</h1>
                <h2>Ø£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ - Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„</h2>
                <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ <span id="player-name">...</span>! Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠ ÙˆØ§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ù…Ù…ØªØ¹!</p>
                
                <div class="character">
                    <i class="fas fa-robot"></i>
                </div>
                
                <div class="game-modes">
                    <div class="mode-card" data-mode="algebra">
                        <i class="fas fa-superscript"></i>
                        <span>Ø§Ù„Ø¬Ø¨Ø± ÙˆØ§Ù„Ù…ØªØ·Ø§Ø¨Ù‚Ø§Øª</span>
                        <small>Ø§Ù„Ù…Ø³ØªÙˆÙ‰: Ù…ØªÙ‚Ø¯Ù…</small>
                    </div>
                    <div class="mode-card" data-mode="geometry">
                        <i class="fas fa-shapes"></i>
                        <span>Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ©</span>
                        <small>Ø§Ù„Ù…Ø³ØªÙˆÙ‰: Ù…ØªÙˆØ³Ø·</small>
                    </div>
                    <div class="mode-card" data-mode="trigonometry">
                        <i class="fas fa-drafting-compass"></i>
                        <span>Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø«Ù„Ø«Ø§Øª</span>
                        <small>Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ØµØ¹Ø¨</small>
                    </div>
                    <div class="mode-card" data-mode="comprehensive">
                        <i class="fas fa-brain"></i>
                        <span>ØªØ­Ø¯ÙŠ Ø´Ø§Ù…Ù„</span>
                        <small>Ø§Ù„Ù…Ø³ØªÙˆÙ‰: Ù†Ø®Ø¨Ø©</small>
                    </div>
                </div>
                
                <button id="start-btn" class="btn" disabled>
                    <i class="fas fa-play"></i> Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ
                </button>
                
                <button id="stats-btn" class="btn">
                    <i class="fas fa-chart-bar"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨
                </button>
            </div>
        </div>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div id="game-screen" class="screen">
            <div class="game-screen">
                <div class="game-header">
                    <div class="player-info">
                        <div class="player-avatar" id="player-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <div id="player-name-display">...</div>
                            <div class="stat-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <span id="player-level">1</span></div>
                        </div>
                    </div>
                    
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" id="score">0</div>
                            <div class="stat-label">Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="correct-count">0</div>
                            <div class="stat-label">ØµØ­ÙŠØ­</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="wrong-count">0</div>
                            <div class="stat-label">Ø®Ø§Ø·Ø¦</div>
                        </div>
                    </div>
                </div>
                
                <div class="question-box">
                    <div class="question" id="question-text">Ø­Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</div>
                    <div class="expression" id="math-expression">5 + 3 = ?</div>
                </div>
                
                <div class="options-grid" id="options-container">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
                
                <div class="feedback" id="feedback"></div>
                
                <div class="timer-container">
                    <div class="timer-bar">
                        <div class="timer" id="timer"></div>
                    </div>
                </div>
                
                <button id="next-btn" class="btn" style="display: none;">
                    <i class="fas fa-arrow-left"></i> Ø§Ù„ØªØ§Ù„ÙŠ
                </button>
            </div>
        </div>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div id="results-screen" class="screen">
            <div class="results-screen">
                <h2>ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„ØªØ­Ø¯ÙŠ</h2>
                
                <div class="trophy">
                    <i class="fas fa-trophy"></i>
                </div>
                
                <div class="score-display" id="final-score">0</div>
                
                <div class="result-message" id="result-message">Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯!</div>
                
                <div class="result-details">
                    <p>
                        <span>Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø®ØªØ§Ø±:</span>
                        <span id="game-mode-result">-</span>
                    </p>
                    <p>
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</span>
                        <span id="total-questions">0</span>
                    </p>
                    <p>
                        <span>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©:</span>
                        <span id="correct-answers">0</span>
                    </p>
                    <p>
                        <span>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©:</span>
                        <span id="wrong-answers">0</span>
                    </p>
                    <p>
                        <span>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©:</span>
                        <span id="total-points">0</span>
                    </p>
                </div>
                
                <div class="achievements">
                    <div class="achievement">
                        <i class="fas fa-star"></i>
                        <div>Ø£Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰</div>
                        <div id="max-level">1</div>
                    </div>
                    <div class="achievement">
                        <i class="fas fa-bolt"></i>
                        <div>Ø£Ø³Ø±Ø¹ Ø¥Ø¬Ø§Ø¨Ø©</div>
                        <div id="fastest-time">0s</div>
                    </div>
                    <div class="achievement">
                        <i class="fas fa-medal"></i>
                        <div>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
                        <div id="rating">-</div>
                    </div>
                </div>
                
                <button id="restart-btn" class="btn">
                    <i class="fas fa-redo"></i> ØªØ­Ø¯Ù‘ÙŠ Ø¬Ø¯ÙŠØ¯
                </button>
                
                <button id="back-to-menu-btn" class="btn">
                    <i class="fas fa-home"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                </button>
            </div>
        </div>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div id="stats-screen" class="screen">
            <div class="stats-screen">
                <h1><i class="fas fa-chart-bar"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
                
                <div class="student-stats">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                        <div class="stat-value" id="total-students">0</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-trophy"></i>
                        <h3>Ø£Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø©</h3>
                        <div class="stat-value" id="highest-score">0</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-brain"></i>
                        <h3>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h3>
                        <div class="stat-value" id="average-score">0</div>
                    </div>
                </div>
                
                <div class="leaderboard">
                    <h2>ØªØµÙ†ÙŠÙ Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                <th>Ø£Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø©</th>
                                <th>Ø¢Ø®Ø± Ù…Ø­Ø§ÙˆÙ„Ø©</th>
                                <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                        </tbody>
                    </table>
                </div>
                
                <button id="back-btn" class="btn">
                    <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø©
                </button>
            </div>
        </div>
    </div>

    <script>
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        let currentPlayer = {
            name: '',
            avatar: '1',
            class: 'Ø£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ'
        };
        
        let currentMode = '';
        let currentLevel = 1;
        let score = 0;
        let correctCount = 0;
        let wrongCount = 0;
        let totalQuestions = 0;
        let selectedOption = null;
        let timerInterval;
        let timeLeft = 15;
        let fastestTime = 999;
        let maxLevel = 1;
        
        // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ (Ù…Ø­Ù„ÙŠØ©)
        let students = JSON.parse(localStorage.getItem('mathChallengeStudents')) || [];
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù…Ø³ØªÙˆÙ‰ Ø£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ
        const questionGenerators = {
            algebra: (level) => {
                const types = [
                    {
                        question: "Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©: 2Ø³ + 5 = 15",
                        expression: "2x + 5 = 15",
                        answer: 5,
                        options: [3, 5, 7, 10]
                    },
                    {
                        question: "Ù…Ø§ Ù‚ÙŠÙ…Ø© Ø³ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©: 3(Ø³ - 2) = 12",
                        expression: "3(x - 2) = 12",
                        answer: 6,
                        options: [4, 5, 6, 7]
                    },
                    {
                        question: "Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©: 2Ø³ - 3 > 7",
                        expression: "2x - 3 > 7",
                        answer: 6,
                        options: [4, 5, 6, 7]
                    },
                    {
                        question: "Ø¨Ø³Ù‘Ø· Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©: (2Ø³ + 3)(Ø³ - 4)",
                        expression: "(2x + 3)(x - 4)",
                        answer: 1,
                        options: ["2Ø³Â² - 5Ø³ - 12", "2Ø³Â² - 11Ø³ - 12", "2Ø³Â² + 5Ø³ - 12", "2Ø³Â² - 5Ø³ + 12"]
                    },
                    {
                        question: "Ø£ÙˆØ¬Ø¯ Ù‚ÙŠÙ…Ø© Øµ Ø¹Ù†Ø¯Ù…Ø§ Ø³ = 3 ÙÙŠ Ø§Ù„Ø¯Ø§Ù„Ø©: Øµ = 2Ø³Â² - 5Ø³ + 1",
                        expression: "y = 2xÂ² - 5x + 1, x = 3",
                        answer: 4,
                        options: [4, 6, 8, 10]
                    }
                ];
                return types[Math.floor(Math.random() * types.length)];
            },
            
            geometry: (level) => {
                const types = [
                    {
                        question: "Ø£ÙˆØ¬Ø¯ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø·ÙˆÙ„Ù‡ 8 Ø³Ù… ÙˆØ¹Ø±Ø¶Ù‡ 5 Ø³Ù…",
                        expression: "Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ = Ø§Ù„Ø·ÙˆÙ„ Ã— Ø§Ù„Ø¹Ø±Ø¶",
                        answer: 40,
                        options: [30, 35, 40, 45]
                    },
                    {
                        question: "Ø£ÙˆØ¬Ø¯ Ù…Ø­ÙŠØ· Ø§Ù„Ù…Ø«Ù„Ø« Ø§Ù„Ø°ÙŠ Ø£Ø·ÙˆØ§Ù„ Ø£Ø¶Ù„Ø§Ø¹Ù‡ 6 Ø³Ù…ØŒ 8 Ø³Ù…ØŒ 10 Ø³Ù…",
                        expression: "Ù…Ø­ÙŠØ· Ø§Ù„Ù…Ø«Ù„Ø« = Ù…Ø¬Ù…ÙˆØ¹ Ø£Ø·ÙˆØ§Ù„ Ø£Ø¶Ù„Ø§Ø¹Ù‡",
                        answer: 24,
                        options: [20, 22, 24, 26]
                    },
                    {
                        question: "Ø£ÙˆØ¬Ø¯ Ø­Ø¬Ù… Ø§Ù„Ù…ÙƒØ¹Ø¨ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø·ÙˆÙ„ Ø­Ø±ÙÙ‡ 4 Ø³Ù…",
                        expression: "Ø­Ø¬Ù… Ø§Ù„Ù…ÙƒØ¹Ø¨ = Ø·ÙˆÙ„ Ø§Ù„Ø­Ø±Ù Ã— Ù†ÙØ³Ù‡ Ã— Ù†ÙØ³Ù‡",
                        answer: 64,
                        options: [48, 56, 64, 72]
                    },
                    {
                        question: "Ø£ÙˆØ¬Ø¯ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†ØµÙ Ù‚Ø·Ø±Ù‡Ø§ 7 Ø³Ù… (Ø· â‰ˆ 3.14)",
                        expression: "Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© = Ï€ Ã— Ù†Ù‚Â²",
                        answer: 154,
                        options: [144, 150, 154, 160]
                    },
                    {
                        question: "Ø£ÙˆØ¬Ø¯ Ø·ÙˆÙ„ Ø§Ù„ÙˆØªØ± ÙÙŠ Ø§Ù„Ù…Ø«Ù„Ø« Ø§Ù„Ù‚Ø§Ø¦Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† Ø·ÙˆÙ„Ø§ Ø§Ù„Ø¶Ù„Ø¹ÙŠÙ† Ø§Ù„Ù‚Ø§Ø¦Ù…ÙŠÙ† 6 Ø³Ù… Ùˆ 8 Ø³Ù…",
                        expression: "Ù†Ø¸Ø±ÙŠØ© ÙÙŠØ«Ø§ØºÙˆØ±Ø³: Ø§Ù„ÙˆØªØ±Â² = (6)Â² + (8)Â²",
                        answer: 10,
                        options: [9, 10, 11, 12]
                    }
                ];
                return types[Math.floor(Math.random() * types.length)];
            },
            
            trigonometry: (level) => {
                const types = [
                    {
                        question: "Ù…Ø§ Ù‚ÙŠÙ…Ø© Ø¬Ø§(30Â°)ØŸ",
                        expression: "sin(30Â°) = ?",
                        answer: 0.5,
                        options: [0, 0.5, 0.707, 1]
                    },
                    {
                        question: "Ù…Ø§ Ù‚ÙŠÙ…Ø© Ø¬ØªØ§(60Â°)ØŸ",
                        expression: "cos(60Â°) = ?",
                        answer: 0.5,
                        options: [0, 0.5, 0.707, 1]
                    },
                    {
                        question: "Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¬Ø§(Ø³) = 0.6ØŒ ÙÙ…Ø§ Ù‚ÙŠÙ…Ø© Ø¬ØªØ§(Ø³)ØŸ",
                        expression: "Ø¬Ø§Â²(Ø³) + Ø¬ØªØ§Â²(Ø³) = 1",
                        answer: 0.8,
                        options: [0.4, 0.6, 0.8, 1]
                    },
                    {
                        question: "Ø£ÙˆØ¬Ø¯ Ù‚ÙŠÙ…Ø©: 2Ø¬Ø§(45Â°)Ø¬ØªØ§(45Â°)",
                        expression: "2sin(45Â°)cos(45Â°)",
                        answer: 1,
                        options: [0.5, 0.707, 1, 1.414]
                    },
                    {
                        question: "Ø¥Ø°Ø§ ÙƒØ§Ù† Ø·ÙˆÙ„ Ø§Ù„ÙˆØªØ± ÙÙŠ Ù…Ø«Ù„Ø« Ù‚Ø§Ø¦Ù… 10 Ø³Ù…ØŒ ÙˆÙ‚ÙŠØ§Ø³ Ø§Ù„Ø²Ø§ÙˆÙŠØ© 30Â°ï¼Œ ÙÙ…Ø§ Ø·ÙˆÙ„ Ø§Ù„Ø¶Ù„Ø¹ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ØŸ",
                        expression: "Ø¬Ø§(30Â°) = Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ / Ø§Ù„ÙˆØªØ±",
                        answer: 5,
                        options: [3, 5, 7, 10]
                    }
                ];
                return types[Math.floor(Math.random() * types.length)];
            },
            
            comprehensive: (level) => {
                // Ø¯Ù…Ø¬ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹
                const allQuestions = [
                    ...questionGenerators.algebra(level).options ? [questionGenerators.algebra(level)] : [],
                    ...questionGenerators.geometry(level).options ? [questionGenerators.geometry(level)] : [],
                    ...questionGenerators.trigonometry(level).options ? [questionGenerators.trigonometry(level)] : []
                ].filter(q => q.options);
                
                return allQuestions[Math.floor(Math.random() * allQuestions.length)];
            }
        };
        
        // Ø¹Ù†Ø§ØµØ± DOM
        const loginScreen = document.getElementById('login-screen');
        const welcomeScreen = document.getElementById('welcome-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultsScreen = document.getElementById('results-screen');
        const statsScreen = document.getElementById('stats-screen');
        
        const loginBtn = document.getElementById('login-btn');
        const startBtn = document.getElementById('start-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');
        const statsBtn = document.getElementById('stats-btn');
        const backBtn = document.getElementById('back-btn');
        
        const studentNameInput = document.getElementById('student-name');
        const avatars = document.querySelectorAll('.avatar');
        const modeCards = document.querySelectorAll('.mode-card');
        
        const playerNameElement = document.getElementById('player-name');
        const playerNameDisplay = document.getElementById('player-name-display');
        const playerAvatar = document.getElementById('player-avatar');
        const playerLevel = document.getElementById('player-level');
        
        const questionText = document.getElementById('question-text');
        const mathExpression = document.getElementById('math-expression');
        const optionsContainer = document.getElementById('options-container');
        const feedbackElement = document.getElementById('feedback');
        const timerElement = document.getElementById('timer');
        
        const scoreElement = document.getElementById('score');
        const correctCountElement = document.getElementById('correct-count');
        const wrongCountElement = document.getElementById('wrong-count');
        
        const finalScoreElement = document.getElementById('final-score');
        const gameModeResult = document.getElementById('game-mode-result');
        const totalQuestionsElement = document.getElementById('total-questions');
        const correctAnswersElement = document.getElementById('correct-answers');
        const wrongAnswersElement = document.getElementById('wrong-answers');
        const totalPointsElement = document.getElementById('total-points');
        const maxLevelElement = document.getElementById('max-level');
        const fastestTimeElement = document.getElementById('fastest-time');
        const ratingElement = document.getElementById('rating');
        const resultMessage = document.getElementById('result-message');
        
        const totalStudentsElement = document.getElementById('total-students');
        const highestScoreElement = document.getElementById('highest-score');
        const averageScoreElement = document.getElementById('average-score');
        const leaderboardBody = document.getElementById('leaderboard-body');
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø©
        function createFloatingMath() {
            const container = document.getElementById('floating-math');
            const symbols = ['Ï€', 'Î¸', 'âˆ‘', 'âˆ«', 'âˆš', 'âˆ', 'Î”', 'Î±', 'Î²', 'Î³', 'Ã·', 'Ã—', 'Â±', 'â‰¤', 'â‰¥', 'â‰ ', '=', '+', '-', 'âˆ ', 'âˆŸ', 'âˆ', 'âˆ´', 'âˆµ'];
            
            for (let i = 0; i < 20; i++) {
                const symbol = document.createElement('div');
                symbol.className = 'floating-math';
                symbol.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                symbol.style.left = `${Math.random() * 100}%`;
                symbol.style.animationDuration = `${10 + Math.random() * 20}s`;
                symbol.style.animationDelay = `${Math.random() * 5}s`;
                container.appendChild(symbol);
            }
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ ØªØ£Ø«ÙŠØ±Ø§Øª ÙƒÙˆÙ†ÙÙŠØªÙŠ
        function createConfetti() {
            const colors = ['#4361ee', '#3a0ca3', '#f72585', '#4cc9f0', '#4ade80'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animation = `confettiFall ${1 + Math.random() * 2}s forwards`;
                document.body.appendChild(confetti);
                
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙˆÙ†ÙÙŠØªÙŠ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        loginBtn.addEventListener('click', () => {
            const name = studentNameInput.value.trim();
            if (name === '') {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ');
                return;
            }
            
            currentPlayer.name = name;
            playerNameElement.textContent = name;
            playerNameDisplay.textContent = name;
            
            // Ø­ÙØ¸ Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
            saveStudentData();
            
            showScreen(welcomeScreen);
        });
        
        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ©
        avatars.forEach(avatar => {
            avatar.addEventListener('click', () => {
                avatars.forEach(a => a.classList.remove('selected'));
                avatar.classList.add('selected');
                currentPlayer.avatar = avatar.getAttribute('data-avatar');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
                const avatarIcon = avatar.querySelector('i').className;
                playerAvatar.innerHTML = `<i class="${avatarIcon}"></i>`;
            });
        });
        
        // Ø§Ø®ØªÙŠØ§Ø± ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø©
        modeCards.forEach(card => {
            card.addEventListener('click', () => {
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                modeCards.forEach(c => c.classList.remove('selected'));
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±
                card.classList.add('selected');
                currentMode = card.getAttribute('data-mode');
                
                // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡
                startBtn.disabled = false;
            });
        });
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        startBtn.addEventListener('click', () => {
            showScreen(gameScreen);
            resetGame();
            generateQuestion();
            startTimer();
        });
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        statsBtn.addEventListener('click', () => {
            updateStatsScreen();
            showScreen(statsScreen);
        });
        
        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù…Ù† Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        backBtn.addEventListener('click', () => {
            showScreen(welcomeScreen);
        });
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
        function resetGame() {
            currentLevel = 1;
            score = 0;
            correctCount = 0;
            wrongCount = 0;
            totalQuestions = 0;
            fastestTime = 999;
            
            updateStats();
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStats() {
            scoreElement.textContent = score;
            playerLevel.textContent = currentLevel;
            correctCountElement.textContent = correctCount;
            wrongCountElement.textContent = wrongCount;
        }
        
        // ØªÙˆÙ„ÙŠØ¯ Ø³Ø¤Ø§Ù„
        function generateQuestion() {
            const questionData = questionGenerators[currentMode](currentLevel);
            questionText.textContent = questionData.question;
            mathExpression.textContent = questionData.expression;
            
            // ØªÙˆÙ„ÙŠØ¯ Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
            const options = Array.isArray(questionData.options) ? 
                [...questionData.options] : 
                [questionData.answer, questionData.answer + 1, questionData.answer - 1, questionData.answer + 2];
            
            // Ø®Ù„Ø· Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            shuffleArray(options);
            
            // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            optionsContainer.innerHTML = '';
            feedbackElement.textContent = '';
            feedbackElement.className = 'feedback';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            options.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option');
                optionElement.textContent = option;
                optionElement.dataset.value = option;
                
                optionElement.addEventListener('click', selectAnswer);
                optionsContainer.appendChild(optionElement);
            });
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
            timeLeft = 15;
            timerElement.style.width = '100%';
            
            // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ
            nextBtn.style.display = 'none';
            
            totalQuestions++;
        }
        
        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        function selectAnswer(e) {
            // Ù…Ù†Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
            document.querySelectorAll('.option').forEach(option => {
                option.removeEventListener('click', selectAnswer);
            });
            
            const selectedValue = e.target.dataset.value;
            const correctAnswer = questionGenerators[currentMode](currentLevel).answer;
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
            clearInterval(timerInterval);
            
            // ØªØ³Ø¬ÙŠÙ„ Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª
            const timeTaken = 15 - timeLeft;
            if (timeTaken < fastestTime) {
                fastestTime = timeTaken;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
            if (selectedValue == correctAnswer) {
                e.target.classList.add('correct');
                feedbackElement.textContent = 'Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! ğŸ‰';
                feedbackElement.className = 'feedback correct-feedback';
                score += currentLevel * 10;
                correctCount++;
                
                // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ø¹Ø¯ 3 Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø© Ù…ØªØªØ§Ù„ÙŠØ©
                if (correctCount % 3 === 0) {
                    currentLevel++;
                    maxLevel = Math.max(maxLevel, currentLevel);
                }
            } else {
                e.target.classList.add('wrong');
                feedbackElement.textContent = `Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${correctAnswer}`;
                feedbackElement.className = 'feedback wrong-feedback';
                wrongCount++;
                
                // Ø®ÙØ¶ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ø¹Ø¯ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©
                if (currentLevel > 1) {
                    currentLevel = Math.max(1, currentLevel - 1);
                }
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ
            nextBtn.style.display = 'inline-block';
            
            updateStats();
        }
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
        nextBtn.addEventListener('click', () => {
            if (totalQuestions >= 10) {
                endGame();
            } else {
                generateQuestion();
                startTimer();
            }
        });
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
        function startTimer() {
            timeLeft = 15;
            timerElement.style.width = '100%';
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.style.width = `${(timeLeft / 15) * 100}%`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
                    document.querySelectorAll('.option').forEach(option => {
                        option.removeEventListener('click', selectAnswer);
                    });
                    
                    const correctAnswer = questionGenerators[currentMode](currentLevel).answer;
                    feedbackElement.textContent = `Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${correctAnswer}`;
                    feedbackElement.className = 'feedback wrong-feedback';
                    wrongCount++;
                    nextBtn.style.display = 'inline-block';
                    updateStats();
                }
            }, 1000);
        }
        
        // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        function endGame() {
            showScreen(resultsScreen);
            createConfetti();
            
            // ØªØ­Ø¯ÙŠØ« Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù„Ø¹Ø¨Ø©
            finalScoreElement.textContent = score;
            gameModeResult.textContent = getModeName(currentMode);
            totalQuestionsElement.textContent = totalQuestions;
            correctAnswersElement.textContent = correctCount;
            wrongAnswersElement.textContent = wrongCount;
            totalPointsElement.textContent = score;
            maxLevelElement.textContent = maxLevel;
            fastestTimeElement.textContent = fastestTime === 999 ? '0s' : `${fastestTime}s`;
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
            const accuracy = (correctCount / totalQuestions) * 100;
            let rating, message;
            
            if (accuracy >= 90) {
                rating = 'Ø¹Ø¨Ù‚Ø±ÙŠ ğŸ‘‘';
                message = 'Ø£Ù†Øª Ø¹Ø¨Ù‚Ø±ÙŠ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª!';
            } else if (accuracy >= 70) {
                rating = 'Ù…ØªÙ…ÙŠØ² â­';
                message = 'Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹!';
            } else if (accuracy >= 50) {
                rating = 'Ø¬ÙŠØ¯ ğŸ‘';
                message = 'Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø³Ù† Ø£ÙƒØ«Ø±!';
            } else {
                rating = 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ† ğŸ’ª';
                message = 'Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©ØŒ Ø³ØªØµØ¨Ø­ Ø£ÙØ¶Ù„!';
            }
            
            ratingElement.textContent = rating;
            resultMessage.textContent = message;
            
            // Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ø§Ù„Ø¨
            saveStudentResult(score);
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        restartBtn.addEventListener('click', () => {
            showScreen(gameScreen);
            resetGame();
            generateQuestion();
            startTimer();
        });
        
        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
        backToMenuBtn.addEventListener('click', () => {
            showScreen(welcomeScreen);
        });
        
        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
        function saveStudentData() {
            const existingStudentIndex = students.findIndex(s => s.name === currentPlayer.name);
            
            if (existingStudentIndex === -1) {
                // Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
                students.push({
                    name: currentPlayer.name,
                    avatar: currentPlayer.avatar,
                    class: currentPlayer.class,
                    attempts: 0,
                    bestScore: 0,
                    lastScore: 0,
                    lastPlayed: new Date().toLocaleDateString('ar-SA')
                });
            }
            
            localStorage.setItem('mathChallengeStudents', JSON.stringify(students));
        }
        
        // Ø­ÙØ¸ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
        function saveStudentResult(score) {
            const studentIndex = students.findIndex(s => s.name === currentPlayer.name);
            
            if (studentIndex !== -1) {
                students[studentIndex].attempts++;
                students[studentIndex].lastScore = score;
                students[studentIndex].lastPlayed = new Date().toLocaleDateString('ar-SA');
                
                if (score > students[studentIndex].bestScore) {
                    students[studentIndex].bestScore = score;
                }
                
                localStorage.setItem('mathChallengeStudents', JSON.stringify(students));
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStatsScreen() {
            totalStudentsElement.textContent = students.length;
            
            if (students.length > 0) {
                const bestScores = students.map(s => s.bestScore);
                const highestScore = Math.max(...bestScores);
                const averageScore = bestScores.reduce((a, b) => a + b, 0) / bestScores.length;
                
                highestScoreElement.textContent = highestScore;
                averageScoreElement.textContent = Math.round(averageScore);
                
                // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø£ÙØ¶Ù„ Ø¯Ø±Ø¬Ø©
                const sortedStudents = [...students].sort((a, b) => b.bestScore - a.bestScore);
                
                // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØµÙ†ÙŠÙ
                leaderboardBody.innerHTML = '';
                sortedStudents.forEach((student, index) => {
                    const row = document.createElement('tr');
                    if (index < 3) {
                        row.classList.add(`rank-${index + 1}`);
                    }
                    
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${student.name}</td>
                        <td>${student.bestScore}</td>
                        <td>${student.lastPlayed}</td>
                        <td>${student.attempts}</td>
                    `;
                    
                    leaderboardBody.appendChild(row);
                });
            } else {
                highestScoreElement.textContent = '0';
                averageScoreElement.textContent = '0';
                leaderboardBody.innerHTML = '<tr><td colspan="5">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
            }
        }
        
        // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„ÙˆØ¶Ø¹
        function getModeName(mode) {
            const names = {
                algebra: 'Ø§Ù„Ø¬Ø¨Ø± ÙˆØ§Ù„Ù…ØªØ·Ø§Ø¨Ù‚Ø§Øª',
                geometry: 'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ©',
                trigonometry: 'Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø«Ù„Ø«Ø§Øª',
                comprehensive: 'ØªØ­Ø¯ÙŠ Ø´Ø§Ù…Ù„'
            };
            return names[mode];
        }
        
        // ÙˆØ¸ÙŠÙØ© Ø®Ù„Ø· Ø§Ù„Ù…ØµÙÙˆÙØ©
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // ÙˆØ¸ÙŠÙØ© ØªØºÙŠÙŠØ± Ø§Ù„Ø´Ø§Ø´Ø©
        function showScreen(screen) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª
            loginScreen.classList.remove('active');
            welcomeScreen.classList.remove('active');
            gameScreen.classList.remove('active');
            resultsScreen.classList.remove('active');
            statsScreen.classList.remove('active');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            screen.classList.add('active');
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        window.onload = function() {
            createFloatingMath();
            
            // Ø¥Ø¶Ø§ÙØ© CSS Ù„Ù„ÙƒÙˆÙ†ÙÙŠØªÙŠ
            const style = document.createElement('style');
            style.textContent = `
                @keyframes confettiFall {
                    0% {
                        opacity: 1;
                        transform: translateY(-100px) rotate(0deg);
                    }
                    100% {
                        opacity: 0;
                        transform: translateY(100vh) rotate(360deg);
                    }
                }
            `;
            document.head.appendChild(style);
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            avatars[0].click();
        };
    </script>
</body>
</html>